<html>
<head><title>Treasure Hunt</title><script src="http://cdnjs.cloudflare.com/ajax/libs/mathjs/3.18.0/math.min.js"></script>
</head>
<body>

    <canvas id="canvas" width=600 height=600 style="border: 1px solid black"></canvas>
    <img id="house" src="house.png" style="display:none" onload="init()"></img>
    <script>
        
        var canvas = document.getElementById("canvas");
        var context = canvas.getContext("2d");
        var angle = 0;
        var distance = 0;
        var numHouses = 1;
        var frame = 0;
        var locations = new Array();
        var house;


        applyWindowToViewportTransformation(-1,1,-1,1,true);
        /**	Textbook function
        *
        * Sets up a transformation in the graphics context so that the canvas will
        * show x-values in the range from left to right, and y-values in the range
        * from bottom to top.  If preserveAspect is true, then one of the ranges
        * will be increased, if necessary, to account for the aspect ratio of the
        * canvas.  This function sets the global variable pixelsize to be the
        * size of a pixel in the new coordinate system.  (If preseverAspect is
        * true, pixelSize is the maximum of its horizontal and vertical sizes.)
        */
        function applyWindowToViewportTransformation(left,right,bottom,top,preserveAspect) {
            var displayAspect, windowAspect;
            var excess;
            if (preserveAspect) {
                // Adjust the limits to match the aspect ratio of the drawing area.
                displayAspect = Math.abs(canvas.height / canvas.width);
                windowAspect = Math.abs(( top-bottom ) / ( right-left ));
                if (displayAspect > windowAspect) {
                    // Expand the viewport vertically.
                    excess = (top-bottom) * (displayAspect/windowAspect - 1)
                    top = top + excess/2
                    bottom = bottom - excess/2
                }
                else if (displayAspect < windowAspect) {
                    // Expand the viewport vertically.
                    excess = (right-left) * (windowAspect/displayAspect - 1)
                    right = right + excess/2
                    left = left - excess/2	
                }
            }
            context.scale( canvas.width / (right-left), canvas.height / (bottom-top) )
            context.translate( -left, -top );
        }  // end of applyWindowToViewportTransformation()







        

        function init(){
            context.drawImage(document.getElementById("house"), 0, 0, 100, 100);
            document.addEventListener("keydown", doKeyDown, false);
            house = document.getElementById("house");
            for(var i = 0; i < numHouses; i++){
                var location = math.matrix([(Math.random()*2 - 1), (Math.random()*2 - 1), (Math.random()*255), 1]);
            
                locations.push(location);
            }


            requestAnimationFrame(display);
        }


        function doKeyDown(evt){
            var code = evt.keyCode;
            switch(code){
                case 37: //left arrow key
                    angle+=1;
                    break;
                case 39: //right arrow key
                    angle-=1;
                    break;
                case 38: //up arrow key
                    distance+=1;
                    break;
                case 40: //down arrow key
                    distance-=1;
                    break;
                default:
                    break;
            }
        }

        function display(){
            frame++;
            if(frame%10 == 0){
                context.fillStyle = "#ffffff";
                context.fillRect(-1,-1,2,2);
                var T = translate(distance, 0, distance);

                for(var i = 0; i < locations.length; i++){
                    var temp = locations[i];
                    temp = math.multiply(T, temp);
                    drawHouse(temp);
                    console.log(temp.subset(math.index([1])));
                }
            }
            requestAnimationFrame(display);
        }

        function drawHouse(temp){
            context.drawImage(house, temp.subset(math.index([0])), temp.subset(math.index([1])), .5, .5);
            
        }

        function translate( tx, ty, tz ) {
            var result = new Array();
            for(var i = 0;i<4; i++) 
                result[i] = new Array();
            for(var i = 0; i<4; i++) for(var j = 0; j<4; j++) result[i][j] = 0;
            
            // create matrix here by populating result	
            result [0][0] =  1;
            result [1][1] =  1;
            result [2][2] =  1;
            result [3][3] =  1;

            result [0][3] =  tx;
            result [1][3] =  ty;
            result [2][3] =  tz;


            var res = math.matrix(result) // this uses mathjs 
            return res ;
        }




    </script>


</body>



</html>